<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Popup 테스트</title>
    <link rel="stylesheet" href="./qunitjs/qunit/qunit.css">
    <style>
        .popup {
            position: absolute;
            top: 20px;
            left: 20px;
            width: 120px;
            height: 120px;
            z-index: 50;
            background: #ffffff;
            display: none;
            border-style: solid;
            border-color: #a0a0a0;
            border-width: 1px;
        }

        .dimed {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1;
            display: none;
        }
    </style>
</head>
<body>
<div id="qunit"></div>
<div id="qunit-fixture"></div>
<div id="button">
    <canvas id="buttonCanvas" width="500" height="60" style="background-color:#FFFFFF"></canvas>
</div>
<div id="content">
    <canvas id="canvas" width="400" height="100" style="background-color:#FFFFFF"></canvas>
</div>
<div id="dimed" class="dimed"></div>
<div id="popup" class="popup">
    <canvas id="popup-panel" width="376" height="218" style="background-color:#FFFFFF"></canvas>
</div>
<script src="./qunitjs/qunit/qunit.js"></script>
<script src="../vendor/easeljs-0.8.1.combined.js"></script>
<script src="../vendor/tweenjs-0.6.1.combined.js"></script>
<script src="../vendor/movieclip-0.8.1.combined.js"></script>
<script src="../vendor/preloadjs-0.6.1.combined.js"></script>

<!-- Namespace -->
<script src="../src/js/namespace.js"></script>

<!-- Assets -->
<script src="assets/Assets.js"></script>

<!-- SimpleButton -->
<script src="../src/js/controls/SimpleButton.js"></script>
<script src="../src/js/utils/SpriteSheetUtil.js"></script>

<script src="../src/js/controls/Popup.js"></script>
<script>

    // Qunit Cookbook
    // https://qunitjs.com/cookbook/
    // ok( truthy [, message ] )
    // equal( actual, expected [, message ] )
    // deepEqual( actual, expected [, message ] )


    var c = createjs;
    var stage = new c.Stage('canvas');
    var buttonStage = new c.Stage('buttonCanvas');
    var popupStage = new c.Stage('popup-panel');

    ss = ss || {};
    images = images || {};

    var queue = new c.LoadQueue();
    queue.on('fileload', handleFileLoad, this);
    queue.on('complete', handleLoadComplete, this, true);

    // let it handle multiple loads concurrently:
    queue.setMaxConnections(8);

    // load our assets, starting with evmovieclip-0.8.1.min.jserything we need to render the spritesheet:
    queue.loadFile({src: './assets/Assets_atlas_.json', type: 'spritesheet', id: 'Assets_atlas_'}, true);
    queue.loadManifest(lib.properties.manifest);


    function handleFileLoad(evt) {
        var o = evt.item;

        if (evt.item.type == 'image') {
            images[evt.item.id] = evt.result;
        }
    }

    function handleLoadComplete() {
        console.log('[[handleLoadComplete]]');
        ss['Assets_atlas_'] = queue.getResult('Assets_atlas_');
        queue = null;

        //stage.enableMouseOver();

        startTest();
    }

    var popup;
    var popupDiv = document.getElementById("popup");
    var dimedDiv = document.getElementById("dimed");

    function startTest() {
        QUnit.test('Popup open/close 테스트', function (assert) {
            assert.equal(0, 0, 'Popup 을 생성합니다');

            popup = new nts.Painter.Popup(popupDiv, dimedDiv);
            popupStage.addChild(popup);

            var openConfirmPopupButton = createButton(20, 10);
            var openConfirmCancelPopupButton = createButton(120, 10);

            var guideTextField = createGuideText('왼쪽 TYPE_CONFIRM 팝업, 오른쪽 TYPE_CONFIRM_CANCEL 팝업');

            openConfirmPopupButton.on('click', function() {
                console.log('TYPE_CONFIRM');
                popup.open(nts.Painter.Popup.TYPE_CONFIRM, '확인 팝업', onConfirmHandler);
            });

            openConfirmCancelPopupButton.on('click', function () {
                console.log('TYPE_CONFIRM_CANCEL');
                popup.open(nts.Painter.Popup.TYPE_CONFIRM_CANCEL, '확인 취소 팝업', onConfirmHandler, onCancelHandler);
                //setTimeout(popup.close.bind(popup), 2000);
            });
        });
    }

    function onConfirmHandler() {
        console.log("onConfirmHandler");
        popup.close();
    }

    function onCancelHandler() {
        console.log("onCancelHandler");
        popup.close();
    }

    function createGuideText(msg) {
        var guideText = msg;
        console.log(guideText);
        var guideTextField = new c.Text(guideText, '24px', '#e67e22');
        stage.addChild(guideTextField);
        stage.update();
        return guideTextField;
    }

    function createButton(x, y) {
        var btn = new c.Shape();
        var btnWidth = 80;
        var btnHeight = 40;
        btn.graphics
            //.setStrokeStyle(1)
            //.beginStroke('red')
                .beginFill('#f1c40f')
                .drawRoundRect(0, 0, btnWidth, btnHeight, 4)
                .endFill();
        btn.x = x || 20;
        btn.y = y || 10;
        buttonStage.addChild(btn);
        buttonStage.update();
        return btn;
    }


</script>
</body>
</html>